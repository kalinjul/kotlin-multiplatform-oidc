name: Deploy swift packages

inputs:
  branch:
    description: "Branch to push to"
    required: true
  token:
    description: "PAT Github token"
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/download-artifact@v3
      with:
        name: oidc-swiftpackages
    - name: Upload Package
      shell: bash
      run: |
        git config --global user.name "Julian Kalinowski"
        git config --global user.email "kalinjul@users.noreply.github.com"
        ls -R
        echo "oidc-core"
        echo "${GITHUB_WORKSPACE}/oidc-core/build/swiftpackage/"
        cd ${GITHUB_WORKSPACE}/oidc-core/build/swiftpackage/
        git init
        git checkout -b ${{ inputs.branch }}
        git add -A
        git commit -m "New ios package"
        git remote add origin https://${{ inputs.token }}@github.com/kalinjul/oidc-core-ios.git
        git fetch
        git rebase origin/${{ inputs.branch }}
        git push origin ${{ inputs.branch }}
        echo "oidc-appsupport"
        cd ${GITHUB_WORKSPACE}/oidc-appsupport/build/swiftpackage/